# Descope Trust Center - AI Agent Rules

## Project Context
This is a Next.js 16 trust center application with React 19, tRPC, Drizzle ORM, and Tailwind CSS.

## Stack
- **Framework**: Next.js 16 (App Router, Server Components)
- **UI**: React 19, Tailwind CSS, shadcn/ui
- **API**: tRPC with tanstack-query
- **Database**: PostgreSQL with Drizzle ORM
- **Auth**: Descope
- **Testing**: Vitest, Playwright, Testing Library

## Code Patterns

### tRPC Client Usage
```typescript
const trpc = useTRPC();
const { data } = useQuery(trpc.router.procedure.queryOptions({ input }));
const mutation = useMutation(trpc.router.procedure.mutationOptions());
```

### Import Order (auto-sorted)
1. Type imports first
2. React/Next.js
3. Third-party
4. Workspace packages (@descope-trust-center/*)
5. Local imports (~/)

### Key Rules
- Use `zod/v4` not `zod`
- Use `import { env } from "~/env"` not `process.env`
- Prefix unused vars with `_`
- Server Components are default - only add "use client" when needed
- Use `cn()` for conditional Tailwind classes

## GitHub Workflow
1. Check `gh issue list --state open --label "P1-high"` for tasks
2. Add `opencode` label when claiming an issue
3. Create branch: `feat/<slug>` or `fix/<slug>`
4. Reference issues in commits: `Closes #N`

## Pre-Commit
```bash
pnpm typecheck && pnpm lint && pnpm test
```

## UBS Quick Reference

**Golden Rule:** `ubs <changed-files>` before every commit.

```bash
ubs file.ts                         # Single file (fast)
ubs $(git diff --name-only --cached)  # Staged files
```

Exit 0 = safe to commit. Exit >0 = fix issues first.
